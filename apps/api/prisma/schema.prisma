// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum CleaningStatus {
  PENDING
  APPROVED
  REJECTED
  SCANNED
  COMPLETED
}

enum CloudProvider {
  NONE
  AZURE_BLOB
  AWS_S3
  GOOGLE_DRIVE
  OTHER
}

model User {
  id           String           @id @default(cuid())
  email        String           @unique
  passwordHash String
  role         Role             @default(USER)
  createdAt    DateTime         @default(now())
  requests     CleaningRequest[]
  backups      Backup[]
}

model CleaningRequest {
  id             String         @id @default(cuid())
  userId         String
  user           User           @relation(fields: [userId], references: [id])
  status         CleaningStatus @default(PENDING)
  deviceInfo     String?
  scanResultJson String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  backups        Backup[]

  @@index([userId])
  @@index([status])
}

model Backup {
  id        String         @id @default(cuid())
  userId    String
  user      User           @relation(fields: [userId], references: [id])
  requestId String
  request   CleaningRequest @relation(fields: [requestId], references: [id])
  data      Json
  createdAt DateTime       @default(now())
  expiresAt DateTime

  @@index([userId])
  @@index([requestId])
  @@index([expiresAt])
}

model CloudConfig {
  id                String        @id @default(cuid())
  provider          CloudProvider @default(NONE)
  enabled           Boolean       @default(false)
  bucketOrContainer String?
  region            String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
}
